rule Win32_Trojan_PathWiper : tc_detection malicious
{
    meta:

        author              = "ReversingLabs"

        source              = "ReversingLabs"
        status              = "RELEASED"
        sharing             = "TLP:WHITE"
        category            = "MALWARE"
        malware             = "PATHWIPER"
        description         = "Yara rule that detects PathWiper trojan."

        tc_detection_type   = "Trojan"
        tc_detection_name   = "PathWiper"
        tc_detection_factor = 5

    strings:

        $find_volumes_p1 = {
            55 8B EC 6A ?? 68 ?? ?? ?? ?? 64 A1 ?? ?? ?? ?? 50 81 EC ?? ?? ?? ?? A1 ?? ?? ?? ??
            33 C5 89 45 ?? 56 57 50 8D 45 ?? 64 A3 ?? ?? ?? ?? 8B 7D ?? 33 F6 89 BD ?? ?? ?? ??
            C7 85 ?? ?? ?? ?? ?? ?? ?? ?? 89 B5 ?? ?? ?? ?? 89 B5 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8D
            85 ?? ?? ?? ?? 89 75 ?? 50 FF 15 ?? ?? ?? ?? 89 85 ?? ?? ?? ?? 83 F8 ?? 75 ?? 89 37
            89 77 ?? 89 77 ?? E9 ?? ?? ?? ?? 8D 8D ?? ?? ?? ?? 8D 51 ?? 8A 01 41 84 C0 75 ?? 2B
            CA 49 80 BD ?? ?? ?? ?? ?? 0F 85 ?? ?? ?? ?? 0F 1F 44 00 ?? 80 BD ?? ?? ?? ?? ?? 0F
            85 ?? ?? ?? ?? 80 BD ?? ?? ?? ?? ?? 0F 85 ?? ?? ?? ?? 80 BD ?? ?? ?? ?? ?? 0F 85 ??
            ?? ?? ?? 80 BC 0D ?? ?? ?? ?? ?? 0F 85 ?? ?? ?? ?? 81 F9 ?? ?? ?? ?? 0F 83 ?? ?? ??
            ?? C6 84 0D ?? ?? ?? ?? ?? 8D 8D ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? 8D 51 ??
            C7 85 ?? ?? ?? ?? ?? ?? ?? ?? C6 85 ?? ?? ?? ?? ?? 0F 1F 00 8A 01 41 84 C0 75 ?? 2B
            CA 8D 85 ?? ?? ?? ?? 51 50 8D 8D ?? ?? ?? ?? E8 ?? ?? ?? ?? C6 45 ?? ?? 39 B5 ?? ??
            ?? ?? 74 ?? 0F 10 85 ?? ?? ?? ?? C7 46 ?? ?? ?? ?? ?? B8 ?? ?? ?? ?? C7 46 ?? ?? ??
            ?? ?? 0F 11 06 C6 85 ?? ?? ?? ?? ?? F3 0F 7E 85 ?? ?? ?? ?? 66 0F D6 46 ?? 83 C6
        }

        $find_volumes_p2 = {
            89 B5 ?? ?? ?? ?? EB ?? 8D 85 ?? ?? ?? ?? 50 56 8D 8D ?? ?? ?? ?? E8 ?? ?? ?? ?? 8B
            B5 ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? C6 45 ?? ?? 83 F8 ?? 72 ?? 8B 8D ?? ?? ?? ?? 8D 50
            ?? 8B C1 81 FA ?? ?? ?? ?? 72 ?? 8B 49 ?? 83 C2 ?? 2B C1 83 C0 ?? 83 F8 ?? 0F 87 ??
            ?? ?? ?? 52 51 E8 ?? ?? ?? ?? 83 C4 ?? 68 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 FF B5 ??
            ?? ?? ?? FF 15 ?? ?? ?? ?? 85 C0 0F 84 ?? ?? ?? ?? 8D 8D ?? ?? ?? ?? 8D 51 ?? 8A 01
            41 84 C0 75 ?? 2B CA 49 80 BD ?? ?? ?? ?? ?? 0F 84 ?? ?? ?? ?? FF B5 ?? ?? ?? ?? FF
            15 ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 89 07 8B 85 ?? ?? ?? ?? 89 77 ?? 89 47 ?? 8D 8D ??
            ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? C7 85 ?? ?? ??
            ?? ?? ?? ?? ?? E8 ?? ?? ?? ?? 8B C7 8B 4D ?? 64 89 0D ?? ?? ?? ?? 59 5F 5E 8B 4D ??
            33 CD E8 ?? ?? ?? ?? 8B E5 5D C3
        }

        $find_files_p1 = {
            55 8B EC 6A ?? 68 ?? ?? ?? ?? 64 A1 ?? ?? ?? ?? 50 81 EC ?? ?? ?? ?? A1 ?? ?? ?? ??
            33 C5 89 45 ?? 56 57 50 8D 45 ?? 64 A3 ?? ?? ?? ?? 8B 45 ?? 33 F6 89 B5 ?? ?? ?? ??
            50 8D 8D ?? ?? ?? ?? 89 75 ?? E8 ?? ?? ?? ?? 8B 95 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 8B
            BD ?? ?? ?? ?? 83 FA ?? 8B 8D ?? ?? ?? ?? 0F 43 C7 C6 45 ?? ?? 80 7C 01 ?? ?? 75 ??
            49 8D 85 ?? ?? ?? ?? 83 FA ?? 89 8D ?? ?? ?? ?? 0F 43 C7 C6 04 08 ?? 6A ?? C7 85 ??
            ?? ?? ?? ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? C7
            85 ?? ?? ?? ?? ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? E8 ?? ?? ?? ?? 89 85 ?? ??
            ?? ?? 8D 8D ?? ?? ?? ?? 83 C4 ?? C7 00 ?? ?? ?? ?? C7 40 ?? ?? ?? ?? ?? 8B 85 ?? ??
            ?? ?? 89 08 8D 85 ?? ?? ?? ?? C6 45 ?? ?? 50 E8 ?? ?? ?? ?? 8B 8D ?? ?? ?? ?? 85 C9
            0F 84 ?? ?? ?? ?? 8B 95 ?? ?? ?? ?? 33 C0 03 D1 8B 8D ?? ?? ?? ?? 85 C9 74 ?? 8B 09
            85 C9 74 ?? 8B 01 4A 85 C0 74 ?? 8B 00 85 C0 74 ?? 8B 00 85 C0 74 ?? 8B 00 EB ?? 33
            C0 8B 48 ?? 8B 40 ?? 49 23 CA C7 45 ?? ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? 8B 04 88 89
            85 ?? ?? ?? ?? 83 78 ?? ?? 8B 78 ?? 89 BD ?? ?? ?? ?? 72 ?? 8B 00 89 85 ?? ?? ?? ??
            83 FF ?? 73 ?? 0F 10 00 89 7D ?? C7 45 ?? ?? ?? ?? ?? 0F 11 45 ?? 8B 7D ?? C7 85 ??
            ?? ?? ?? ?? ?? ?? ?? E9 ?? ?? ?? ?? 8B C7 B9 ?? ?? ?? ?? 83 C8 ?? 3D ?? ?? ?? ?? 0F
            47 C1 89 85 ?? ?? ?? ?? 8D 48 ?? 81 F9 ?? ?? ?? ?? 72 ?? 8D 41 ?? 3B C1 B9 ?? ?? ??
            ?? 0F 46 C1 50 E8 ?? ?? ?? ?? 83 C4 ?? 85 C0 0F 84 ?? ?? ?? ?? 8D 78 ?? 83 E7 ?? 89
        }

        $find_files_p2 = {
            47 ?? EB ?? 85 C9 74 ?? 51 E8 ?? ?? ?? ?? 83 C4 ?? 8B F8 EB ?? 33 FF 8B 85 ?? ?? ??
            ?? 40 89 7D ?? 50 FF B5 ?? ?? ?? ?? 57 E8 ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 83 C4 ?? 89
            45 ?? 8B 85 ?? ?? ?? ?? 89 45 ?? 8D 8D ?? ?? ?? ?? E8 ?? ?? ?? ?? 8B 85 ?? ?? ?? ??
            8D 4D ?? 83 C0 ?? C6 45 ?? ?? 83 CE ?? C7 45 ?? ?? ?? ?? ?? 50 C7 45 ?? ?? ?? ?? ??
            C6 45 ?? ?? 89 B5 ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 BD ?? ?? ?? ?? ?? 8D 45 ?? 8B 8D ??
            ?? ?? ?? 51 0F 43 C7 8D 4D ?? 50 E8 ?? ?? ?? ?? 6A ?? 68 ?? ?? ?? ?? 8D 4D ?? E8 ??
            ?? ?? ?? 83 7D ?? ?? 8D 8D ?? ?? ?? ?? 8D 45 ?? 0F 43 45 ?? 51 50 FF 15 ?? ?? ?? ??
            8B 55 ?? 83 E6 ?? 89 85 ?? ?? ?? ?? C6 45 ?? ?? 83 FA ?? 72 ?? 8B 4D ?? 42 8B C1 81
            FA ?? ?? ?? ?? 72 ?? 8B 49 ?? 83 C2 ?? 2B C1 83 C0 ?? 83 F8 ?? 0F 87 ?? ?? ?? ?? 52
            51 E8 ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 83 C4 ?? C7 45 ?? ?? ?? ?? ?? C7 45 ?? ?? ?? ??
            ?? C6 45 ?? ?? 83 F8 ?? 0F 84 ?? ?? ?? ?? 8B BD ?? ?? ?? ?? 0F 1F 84 00 ?? ?? ?? ??
            80 BD ?? ?? ?? ?? ?? 89 B5 ?? ?? ?? ?? 75 ?? 8A 85 ?? ?? ?? ?? 84 C0 0F 84 ?? ?? ??
            ?? 3C ?? 75 ?? 80 BD ?? ?? ?? ?? ?? 0F 84 ?? ?? ?? ?? F7 85 ?? ?? ?? ?? ?? ?? ?? ??
            74 ?? 80 7D ?? ?? 0F 84 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? C7 45 ??
            ?? ?? ?? ?? 8D 50 ?? C6 85 ?? ?? ?? ?? ?? 8A 08 40 84 C9 75 ?? 2B C2 8D 8D ?? ?? ??
            ?? 50 8D 85 ?? ?? ?? ?? 50 E8 ?? ?? ?? ?? 83 CE ?? C6 45 ?? ?? 89 B5 ?? ?? ?? ?? 8D
        }

        $find_files_p3 = {
            4D ?? 8B 75 ?? C7 45 ?? ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? C6 45 ?? ?? 8D 46 ?? 50 E8
            ?? ?? ?? ?? 83 7D ?? ?? 8D 45 ?? 56 0F 43 45 ?? 8D 4D ?? 50 E8 ?? ?? ?? ?? 6A ?? 8D
            4D ?? E8 ?? ?? ?? ?? 8B 7D ?? 8B C7 8B 4D ?? 2B C1 8B 55 ?? 8B 75 ?? 3B D0 76 ?? 8B
            C6 2B C2 3B C1 72 ?? 83 FF ?? 8D 45 ?? 51 0F 43 45 ?? 8D 8D ?? ?? ?? ?? 50 6A ?? E8
            ?? ?? ?? ?? EB ?? 83 FE ?? 8D 85 ?? ?? ?? ?? 52 0F 43 85 ?? ?? ?? ?? 8D 4D ?? 50 E8
            ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? 0F 10 00 0F 11 45 ?? F3 0F 7E
            40 ?? 66 0F D6 45 ?? C7 40 ?? ?? ?? ?? ?? C7 40 ?? ?? ?? ?? ?? C6 00 ?? 8B B5 ?? ??
            ?? ?? 83 E6 ?? 83 CE ?? 8B 55 ?? C6 45 ?? ?? 83 FA ?? 72 ?? 8B 4D ?? 42 8B C1 81 FA
            ?? ?? ?? ?? 72 ?? 8B 49 ?? 83 C2 ?? 2B C1 83 C0 ?? 83 F8 ?? 0F 87 ?? ?? ?? ?? 52 51
            E8 ?? ?? ?? ?? 83 C4 ?? C7 45 ?? ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? C6 45 ?? ?? 8B 55
            ?? C6 45 ?? ?? 83 FA ?? 72 ?? 8B 8D ?? ?? ?? ?? 42 8B C1 81 FA ?? ?? ?? ?? 72 ?? 8B
            49 ?? 83 C2 ?? 2B C1 83 C0 ?? 83 F8 ?? 0F 87 ?? ?? ?? ?? 52 51 E8 ?? ?? ?? ?? 83 C4
            ?? F6 85 ?? ?? ?? ?? ?? 8B 4D ?? C7 45 ?? ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? C6 85 ??
            ?? ?? ?? ?? 0F 84 ?? ?? ?? ?? C6 85 ?? ?? ?? ?? ?? 85 C9 0F 84 ?? ?? ?? ?? 8B 01 8D
            95 ?? ?? ?? ?? 52 8D 55 ?? 52 8B 40 ?? FF D0 84 C0 0F 84 ?? ?? ?? ?? 80 7D ?? ?? 0F
            84 ?? ?? ?? ?? 8B 95 ?? ?? ?? ?? 8B 8D ?? ?? ?? ?? 8D 42 ?? 3B C8 77 ?? 6A ?? 8D 8D
            ?? ?? ?? ?? E8 ?? ?? ?? ?? 8B 95 ?? ?? ?? ?? 8B 8D ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 49
        }

        $find_files_p4 = {
            23 C1 89 85 ?? ?? ?? ?? 03 C2 23 C1 8B 8D ?? ?? ?? ?? 8D 3C 85 ?? ?? ?? ?? 83 3C 0F
            ?? 75 ?? 6A ?? E8 ?? ?? ?? ?? 8B 8D ?? ?? ?? ?? 83 C4 ?? 89 04 0F 8B 8D ?? ?? ?? ??
            8B 0C 0F 8D 45 ?? 50 E8 ?? ?? ?? ?? FF 85 ?? ?? ?? ?? EB ?? C6 85 ?? ?? ?? ?? ?? 85
            C9 0F 84 ?? ?? ?? ?? 8B 01 8D 95 ?? ?? ?? ?? 52 8D 55 ?? 52 FF 50 ?? 8B 55 ?? C6 45
            ?? ?? 83 FA ?? 72 ?? 8B 4D ?? 42 8B C1 81 FA ?? ?? ?? ?? 72 ?? 8B 49 ?? 83 C2 ?? 2B
            C1 83 C0 ?? 83 F8 ?? 0F 87 ?? ?? ?? ?? 52 51 E8 ?? ?? ?? ?? 83 C4 ?? 8B BD ?? ?? ??
            ?? 8D 85 ?? ?? ?? ?? 50 57 FF 15 ?? ?? ?? ?? 85 C0 0F 85 ?? ?? ?? ?? 57 FF 15 ?? ??
            ?? ?? 8B 55 ?? C6 45 ?? ?? 83 FA ?? 72 ?? 8B 4D ?? 42 8B C1 81 FA ?? ?? ?? ?? 72 ??
            8B 49 ?? 83 C2 ?? 2B C1 83 C0 ?? 83 F8 ?? 0F 87 ?? ?? ?? ?? 52 51 E8 ?? ?? ?? ?? 83
            C4 ?? 8B 8D ?? ?? ?? ?? 85 C9 0F 85 ?? ?? ?? ?? 8D 8D ?? ?? ?? ?? E8 ?? ?? ?? ?? 8B
            95 ?? ?? ?? ?? 83 FA ?? 72 ?? 8B 8D ?? ?? ?? ?? 42 8B C1 81 FA ?? ?? ?? ?? 72 ?? 8B
            49 ?? 83 C2 ?? 2B C1 83 C0 ?? 83 F8 ?? 77 ?? 52 51 E8 ?? ?? ?? ?? 83 C4 ?? 8B 4D ??
            C7 85 ?? ?? ?? ?? ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? C6 85 ?? ?? ?? ?? ?? 85
            C9 74 ?? 8B 11 8D 45 ?? 3B C8 0F 95 C0 0F B6 C0 50 FF 52 ?? 8B 4D ?? 64 89 0D ?? ??
            ?? ?? 59 5F 5E 8B 4D ?? 33 CD E8 ?? ?? ?? ?? 8B E5 5D C3
        }

        $find_shared_network_drives_p1 = {
            55 8B EC 6A ?? 68 ?? ?? ?? ?? 64 A1 ?? ?? ?? ?? 50 81 EC ?? ?? ?? ?? A1 ?? ?? ?? ??
            33 C5 89 45 ?? 56 57 50 8D 45 ?? 64 A3 ?? ?? ?? ?? 8B 7D ?? 89 BD ?? ?? ?? ?? C7 85
            ?? ?? ?? ?? ?? ?? ?? ?? 89 BD ?? ?? ?? ?? C7 07 ?? ?? ?? ?? C7 47 ?? ?? ?? ?? ?? C7
            47 ?? ?? ?? ?? ?? 6A ?? 6A ?? 8D 8D ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? C7 85 ?? ?? ??
            ?? ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? C7 85 ??
            ?? ?? ?? ?? ?? ?? ?? E8 ?? ?? ?? ?? 89 85 ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? C7 85 ??
            ?? ?? ?? ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? 6A
            ?? 8D 8D ?? ?? ?? ?? C6 45 ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? E8 ?? ?? ?? ?? 33 C0
            C7 45 ?? ?? ?? ?? ?? 66 89 45 ?? B1 ?? 88 45 ?? 0F 57 C0 8A 45 ?? BE ?? ?? ?? ?? 32
            C1 C7 45 ?? ?? ?? ?? ?? 0F 11 85 ?? ?? ?? ?? 88 85 ?? ?? ?? ?? B8 ?? ?? ?? ?? F7 E6
            6A ?? 68 ?? ?? ?? ?? 52 50 C6 85 ?? ?? ?? ?? ?? C6 85 ?? ?? ?? ?? ?? C6 85 ?? ?? ??
            ?? ?? C6 85 ?? ?? ?? ?? ?? C6 85 ?? ?? ?? ?? ?? C6 85 ?? ?? ?? ?? ?? C6 85 ?? ?? ??
            ?? ?? C6 85 ?? ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? E8 ?? ?? ?? ?? 8B C8 32 85
            ?? ?? ?? ?? 88 85 ?? ?? ?? ?? 8B C1 F7 E6 6A ?? 68 ?? ?? ?? ?? 52 50 E8 ?? ?? ?? ??
            8B C8 32 85 ?? ?? ?? ?? 88 85 ?? ?? ?? ?? 8B C1 F7 E6 6A ?? 68 ?? ?? ?? ?? 52 50 E8
            ?? ?? ?? ?? 8B C8 32 85 ?? ?? ?? ?? 88 85 ?? ?? ?? ?? 8B C1 F7 E6 6A ?? 68 ?? ?? ??
            ?? 52 50 E8 ?? ?? ?? ?? 8B C8 32 85 ?? ?? ?? ?? 88 85 ?? ?? ?? ?? 8B C1 F7 E6 6A
        }

        $find_shared_network_drives_p2 = {
            68 ?? ?? ?? ?? 52 50 E8 ?? ?? ?? ?? 8B C8 32 85 ?? ?? ?? ?? 88 85 ?? ?? ?? ?? 8B C1
            F7 E6 6A ?? 68 ?? ?? ?? ?? 52 50 E8 ?? ?? ?? ?? 8B C8 32 85 ?? ?? ?? ?? 88 85 ?? ??
            ?? ?? 8B C1 F7 E6 6A ?? 68 ?? ?? ?? ?? 52 50 E8 ?? ?? ?? ?? 8B C8 32 85 ?? ?? ?? ??
            88 85 ?? ?? ?? ?? 8B C1 F7 E6 6A ?? 68 ?? ?? ?? ?? 52 50 E8 ?? ?? ?? ?? 32 85 ?? ??
            ?? ?? 8D 4D ?? 88 85 ?? ?? ?? ?? 8D 51 ?? 0F 10 85 ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ??
            C7 45 ?? ?? ?? ?? ?? 0F 11 45 ?? C6 45 ?? ?? 8A 01 41 84 C0 75 ?? 2B CA 8D 45 ?? 51
            50 8D 4D ?? E8 ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? B9 ?? ?? ?? ?? C6 45 ?? ??
            0F 57 C0 89 8D ?? ?? ?? ?? 0F 11 45 ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? 33 F6 C7 85 ??
            ?? ?? ?? ?? ?? ?? ?? BF ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? 89 4D ?? 66 66 66
            0F 1F 84 00 ?? ?? ?? ?? 8A 84 35 ?? ?? ?? ?? 32 C1 88 44 35 ?? 8B C1 F7 E7 6A ?? 68
            ?? ?? ?? ?? 52 50 E8 ?? ?? ?? ?? 46 8B C8 83 FE ?? 72 ?? 0F 10 45 ?? 8B BD ?? ?? ??
            ?? 8D 4D ?? C7 45 ?? ?? ?? ?? ?? 8D 51 ?? 0F 11 45 ?? C7 45 ?? ?? ?? ?? ?? C6 45 ??
            ?? 0F 1F 00 8A 01 41 84 C0 75 ?? 2B CA 8D 45 ?? 51 50 8D 4D ?? E8 ?? ?? ?? ?? BE ??
            ?? ?? ?? 89 B5 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? C6 45 ?? ?? 50 68 ?? ?? ?? ?? 6A ?? 6A
            ?? 68 ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 85 C0 0F 85 ?? ?? ?? ?? 33 C9 89 8D ?? ?? ?? ??
            8D 85 ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? 50 51 FF B5 ?? ?? ?? ?? E8 ?? ?? ??
            ?? 83 C4 ?? 3D ?? ?? ?? ?? 0F 84 ?? ?? ?? ?? 8B BD ?? ?? ?? ?? 85 FF 0F 84 ?? ?? ??
            ?? 8B CF C7 45 ?? ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? C6 45 ?? ?? 8D 51 ?? 8A 01 41 84
        }

        $find_shared_network_drives_p3 = {
            C0 75 ?? 2B CA 51 57 8D 4D ?? E8 ?? ?? ?? ?? 83 7D ?? ?? 8D 45 ?? FF 75 ?? 0F 43 45
            ?? 8D 4D ?? 50 C6 45 ?? ?? E8 ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? 8D 8D ?? ?? ?? ?? C7
            45 ?? ?? ?? ?? ?? 83 CE ?? 51 0F 10 00 68 ?? ?? ?? ?? 6A ?? 0F 11 45 ?? 89 B5 ?? ??
            ?? ?? F3 0F 7E 40 ?? 66 0F D6 45 ?? C7 40 ?? ?? ?? ?? ?? C7 40 ?? ?? ?? ?? ?? C6 00
            ?? 8D 45 ?? 83 7D ?? ?? 0F 43 45 ?? 50 68 ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 8B 55 ?? 85
            C0 0F 94 85 ?? ?? ?? ?? 83 FA ?? 72 ?? 8B 4D ?? 42 8B C1 81 FA ?? ?? ?? ?? 72 ?? 8B
            49 ?? 83 C2 ?? 2B C1 83 C0 ?? 83 F8 ?? 0F 87 ?? ?? ?? ?? 52 51 E8 ?? ?? ?? ?? 83 C4
            ?? 8B 55 ?? C7 45 ?? ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? C6 45 ?? ?? C6 45 ?? ?? 83 FA
            ?? 72 ?? 8B 4D ?? 42 8B C1 81 FA ?? ?? ?? ?? 72 ?? 8B 49 ?? 83 C2 ?? 2B C1 83 C0 ??
            83 F8 ?? 0F 87 ?? ?? ?? ?? 52 51 E8 ?? ?? ?? ?? 83 C4 ?? 80 BD ?? ?? ?? ?? ?? 0F 84
            ?? ?? ?? ?? 33 C0 89 85 ?? ?? ?? ?? 0F 1F 84 00 ?? ?? ?? ?? 8D 8D ?? ?? ?? ?? C7 85
            ?? ?? ?? ?? ?? ?? ?? ?? 51 50 FF B5 ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 ?? 3D ?? ?? ??
            ?? 0F 84 ?? ?? ?? ?? 8B B5 ?? ?? ?? ?? 85 F6 0F 84 ?? ?? ?? ?? 8B CE C7 45 ?? ?? ??
            ?? ?? C7 45 ?? ?? ?? ?? ?? C6 45 ?? ?? 8D 51 ?? 8A 01 41 84 C0 75 ?? 2B CA 51 56 8D
            4D ?? E8 ?? ?? ?? ?? 83 7D ?? ?? 8D 75 ?? 8B 7D ?? BA ?? ?? ?? ?? 0F 43 75 ?? 33 C9
            85 FF 74 ?? 0F 1F 40 ?? 0F B6 04 31 41 33 C2 69 D0 ?? ?? ?? ?? 3B CF 72 ?? 23 95 ??
            ?? ?? ?? 8B BD ?? ?? ?? ?? 8B 8D ?? ?? ?? ?? 89 95 ?? ?? ?? ?? 89 8D ?? ?? ?? ?? 8B
            04 D7 8B F0 89 85 ?? ?? ?? ?? 66 0F 1F 44 00 ?? 3B C1 75 ?? 8B C1 EB ?? 8B 44 D7
        }

        $find_shared_network_drives_p4 = {
            8B 00 3B F0 0F 84 ?? ?? ?? ?? 83 7D ?? ?? 8D 4E ?? 8B 79 ?? 8D 55 ?? 0F 43 55 ?? 83
            79 ?? ?? 72 ?? 8B 09 3B 7D ?? 75 ?? 83 EF ?? 72 ?? 0F 1F 80 ?? ?? ?? ?? 8B 01 3B 02
            75 ?? 83 C1 ?? 83 C2 ?? 83 EF ?? 73 ?? 83 FF ?? 74 ?? 8A 01 3A 02 75 ?? 83 FF ?? 74
            ?? 8A 41 ?? 3A 42 ?? 75 ?? 83 FF ?? 74 ?? 8A 41 ?? 3A 42 ?? 75 ?? 83 FF ?? 74 ?? 8A
            41 ?? 3A 42 ?? 74 ?? 1B C0 83 C8 ?? EB ?? 33 C0 85 C0 74 ?? 8B 36 8B 95 ?? ?? ?? ??
            8B 8D ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 8B BD ?? ?? ?? ?? E9 ?? ?? ?? ?? 8D 46 ?? 50 8D
            45 ?? 50 8D 8D ?? ?? ?? ?? E8 ?? ?? ?? ?? 8B BD ?? ?? ?? ?? 84 C0 0F 45 F7 EB ?? 8B
            BD ?? ?? ?? ?? 8B F1 8D 4D ?? E8 ?? ?? ?? ?? 3B F7 0F 85 ?? ?? ?? ?? 8B B5 ?? ?? ??
            ?? 8D 7D ?? 83 7D ?? ?? 8B CE C7 45 ?? ?? ?? ?? ?? 0F 43 7D ?? C7 45 ?? ?? ?? ?? ??
            C6 45 ?? ?? 8D 51 ?? 90 8A 01 41 84 C0 75 ?? 2B CA 51 56 8D 4D ?? E8 ?? ?? ?? ?? 8D
            45 ?? C6 45 ?? ?? 50 8D 45 ?? 50 8D 85 ?? ?? ?? ?? 50 E8 ?? ?? ?? ?? 83 C4 ?? 6A ??
            68 ?? ?? ?? ?? 8B C8 C6 45 ?? ?? E8 ?? ?? ?? ?? 83 8D ?? ?? ?? ?? ?? C7 45 ?? ?? ??
            ?? ?? C7 45 ?? ?? ?? ?? ?? 0F 10 00 0F 11 45 ?? F3 0F 7E 40 ?? 66 0F D6 45 ?? C7 40
            ?? ?? ?? ?? ?? C7 40 ?? ?? ?? ?? ?? C6 00 ?? FF B5 ?? ?? ?? ?? 8D 45 ?? C6 45 ?? ??
            50 8D 85 ?? ?? ?? ?? 50 E8 ?? ?? ?? ?? 83 C4 ?? 89 85 ?? ?? ?? ?? 83 78 ?? ?? 72 ??
            8B 00 89 85 ?? ?? ?? ?? 68 ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? C7 85 ?? ?? ??
            ?? ?? ?? ?? ?? E8 ?? ?? ?? ?? 8B F0 83 C4 ?? 85 F6 0F 84 ?? ?? ?? ?? 8D 85 ?? ?? ??
            ?? 50 68 ?? ?? ?? ?? 6A ?? FF B5 ?? ?? ?? ?? 68 ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 85 C0
        }

        $find_shared_network_drives_p5 = {
            75 ?? 66 66 0F 1F 84 00 ?? ?? ?? ?? 81 BD ?? ?? ?? ?? ?? ?? ?? ?? 73 ?? 8D 85 ?? ??
            ?? ?? 50 56 8D 85 ?? ?? ?? ?? 50 6A ?? 57 FF B5 ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 85 C0
            74 ?? 56 3D ?? ?? ?? ?? 75 ?? 81 85 ?? ?? ?? ?? ?? ?? ?? ?? E8 ?? ?? ?? ?? FF B5 ??
            ?? ?? ?? E8 ?? ?? ?? ?? 8B F0 83 C4 ?? 85 F6 75 ?? EB ?? E8 ?? ?? ?? ?? 83 C4 ?? 33
            F6 FF B5 ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 8D 8D ?? ?? ?? ?? 89 B5 ?? ?? ?? ?? E8 ?? ??
            ?? ?? 8D 4D ?? E8 ?? ?? ?? ?? 8D 8D ?? ?? ?? ?? E8 ?? ?? ?? ?? 8D 4D ?? C6 45 ?? ??
            E8 ?? ?? ?? ?? 85 F6 74 ?? 8B BD ?? ?? ?? ?? 8B 4F ?? 39 4F ?? 74 ?? 8B D6 C7 41 ??
            ?? ?? ?? ?? C7 41 ?? ?? ?? ?? ?? C6 01 ?? 8D 7A ?? 0F 1F 80 ?? ?? ?? ?? 8A 02 42 84
            C0 75 ?? 2B D7 52 56 E8 ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 83 40 ?? ?? EB ?? 8D 85 ?? ??
            ?? ?? 50 51 8B CF E8 ?? ?? ?? ?? 8B B5 ?? ?? ?? ?? 56 E8 ?? ?? ?? ?? 83 C4 ?? 8B 85
            ?? ?? ?? ?? 8D 8D ?? ?? ?? ?? 8B 30 8D 85 ?? ?? ?? ?? 50 8B 7E ?? 57 56 E8 ?? ?? ??
            ?? 8B 8D ?? ?? ?? ?? 8B D0 B8 ?? ?? ?? ?? 2B C1 83 F8 ?? 0F 82 ?? ?? ?? ?? 41 89 8D
            ?? ?? ?? ?? 8D 8D ?? ?? ?? ?? 89 56 ?? 89 17 8B 85 ?? ?? ?? ?? 8B 00 50 83 C0 ?? 50
            8D 85 ?? ?? ?? ?? 50 E8 ?? ?? ?? ?? FF B5 ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 ?? 8B 85
            ?? ?? ?? ?? 40 89 85 ?? ?? ?? ?? 83 F8 ?? 0F 82 ?? ?? ?? ?? 8B B5 ?? ?? ?? ?? 8B BD
            ?? ?? ?? ?? 57 E8 ?? ?? ?? ?? 83 C4 ?? 8B 8D ?? ?? ?? ?? 41 89 8D ?? ?? ?? ?? 81 F9
            ?? ?? ?? ?? 0F 82 ?? ?? ?? ?? FF B5 ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 8B BD ?? ?? ?? ??
            8B 55 ?? 83 FA ?? 72 ?? 8B 4D ?? 42 8B C1 81 FA ?? ?? ?? ?? 72 ?? 8B 49 ?? 83 C2 ??
            2B C1 83 C0 ?? 83 F8 ?? 77 ?? 52 51 E8 ?? ?? ?? ?? 83 C4 ?? 8B 55 ?? C7 45
        }

        $overwrite_files_1 = {
            55 8B EC 83 EC ?? 53 8B 5D ?? 56 8B 75 ?? 53 56 FF 75 ?? 89 5D ?? E8 ?? ?? ?? ?? 83
            C4 ?? 3B C6 0F 85 ?? ?? ?? ?? 3B D3 0F 85 ?? ?? ?? ?? 57 8B 7D ?? 33 C0 89 45 ?? 85
            FF 0F 84 ?? ?? ?? ?? 8B DE 6A ?? FF 75 ?? FF 77 ?? FF 77 ?? E8 ?? ?? ?? ?? 8B FA 8B
            F0 8B 45 ?? 57 56 FF 75 ?? 89 45 ?? E8 ?? ?? ?? ?? 8B 4D ?? 83 C4 ?? 03 DE 89 45 ??
            8B C2 13 CF 89 45 ?? 39 5D ?? 75 ?? 3B C1 75 ?? 8B 7D ?? 33 F6 8B 1F 0F AF 5D ?? 85
            DB 74 ?? 8B 45 ?? 8B FB 2B FE 3B C7 0F 42 F8 57 FF 75 ?? FF 75 ?? E8 ?? ?? ?? ?? 8B
            45 ?? 83 C4 ?? 03 F7 80 7D ?? ?? 75 ?? 3B F0 74 ?? 3B F3 72 ?? 8B 7D ?? 8B 45 ?? 8B
            5D ?? 01 75 ?? 50 53 FF 75 ?? E8 ?? ?? ?? ?? 83 C4 ?? 3B C3 75 ?? 3B 55 ?? 75 ?? 8B
            7F ?? 89 7D ?? 85 FF 0F 85 ?? ?? ?? ?? 8B 45 ?? 5F 5E 5B 8B E5 5D C3
        }

        $overwrite_files_2 = {
            55 8B EC 81 EC ?? ?? ?? ?? A1 ?? ?? ?? ?? 33 C5 89 45 ?? 53 56 8B 75 ?? 8D 85 ?? ??
            ?? ?? 57 68 ?? ?? ?? ?? 6A ?? 32 DB 50 89 9D ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 ?? C7
            85 ?? ?? ?? ?? ?? ?? ?? ?? 83 7E ?? ?? 72 ?? 8B 36 56 E8 ?? ?? ?? ?? 8B F8 83 C4 ??
            83 FF ?? 0F 84 ?? ?? ?? ?? 57 E8 ?? ?? ?? ?? 83 C4 ?? 89 85 ?? ?? ?? ?? 85 C0 0F 84
            ?? ?? ?? ?? 80 B8 ?? ?? ?? ?? ?? 0F 85 ?? ?? ?? ?? 57 E8 ?? ?? ?? ?? 8B F0 83 C4 ??
            89 B5 ?? ?? ?? ?? 85 F6 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? 33 DB E8 ?? ?? ?? ?? 83 C4
            ?? 89 85 ?? ?? ?? ?? 85 C0 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? 53 50 E8 ?? ?? ?? ?? 53
            68 ?? ?? ?? ?? 57 E8 ?? ?? ?? ?? 83 C4 ?? 3D ?? ?? ?? ?? 75 ?? 85 D2 75 ?? 68 ?? ??
            ?? ?? FF B5 ?? ?? ?? ?? 57 E8 ?? ?? ?? ?? 83 C4 ?? 3D ?? ?? ?? ?? 75 ?? 50 E8 ?? ??
            ?? ?? 8B D8 83 C4 ?? 85 DB 74 ?? 68 ?? ?? ?? ?? 6A ?? 53 E8 ?? ?? ?? ?? 56 E8 ?? ??
            ?? ?? 8B F0 8B C2 50 56 57 89 85 ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 ?? 3B C6 75 ?? 3B
            95 ?? ?? ?? ?? 75 ?? 68 ?? ?? ?? ?? 53 57 E8 ?? ?? ?? ?? 83 C4 ?? FF B5 ?? ?? ?? ??
            E8 ?? ?? ?? ?? 83 C4 ?? 85 DB 74 ?? 53 E8 ?? ?? ?? ?? 83 C4 ?? 8B 9D ?? ?? ?? ?? 6A
            ?? 6A ?? 57 E8 ?? ?? ?? ?? 83 C4 ?? 0B C2 75 ?? 68 ?? ?? ?? ?? 50 8D 85 ?? ?? ?? ??
            50 E8 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 57 E8 ?? ?? ?? ?? 83 C4 ?? 0F
            B6 DB 3D ?? ?? ?? ?? B9 ?? ?? ?? ?? 0F 44 D9 8B B5 ?? ?? ?? ?? FF B5 ?? ?? ?? ?? E8
            ?? ?? ?? ?? 83 C4 ?? 85 F6 74 ?? 56 E8 ?? ?? ?? ?? 83 C4 ?? 57 E8 ?? ?? ?? ?? 83 C4
            ?? 8B 4D ?? 8A C3 5F 5E 33 CD 5B E8 ?? ?? ?? ?? 8B E5 5D C3 6A ?? 68 ?? ?? ?? ?? 57
            E8 ?? ?? ?? ?? 83 C4 ?? 3D ?? ?? ?? ?? 0F 85 ?? ?? ?? ?? 85 D2 0F 85 ?? ?? ?? ?? 50
            8D 85 ?? ?? ?? ?? 50 57 E8 ?? ?? ?? ?? 83 C4
        }

    condition:
        uint16(0) == 0x5A4D and
        (
            all of ($find_volumes_p*)
        ) and
        (
            all of ($find_files_p*)
        ) and
        (
            all of ($find_shared_network_drives_p*)
        ) and
        (
            all of ($overwrite_files_*)
        )
}